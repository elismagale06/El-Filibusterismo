<!DOCTYPE html>
<html lang="tl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>El Filibusterismo - Word Search Activity</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Garamond", "Georgia", serif;
        background: #f4ead5;
        padding: 20px;
        background-image: repeating-linear-gradient(
            90deg,
            transparent,
            transparent 2px,
            rgba(139, 69, 19, 0.03) 2px,
            rgba(139, 69, 19, 0.03) 4px
          ),
          repeating-linear-gradient(
            0deg,
            transparent,
            transparent 2px,
            rgba(139, 69, 19, 0.03) 2px,
            rgba(139, 69, 19, 0.03) 4px
          );
        color: #2c1810;
        min-height: 100vh;
      }

      .container {
        width: 100%;
        max-width: 100%;
        margin: 0;
        padding: 0 10px;
      }

      header {
        background-color: #fff8e7;
        border: 3px solid #8b4513;
        padding: 20px;
        margin-bottom: 20px;
        border-radius: 10px;
        text-align: center;
      }

      h1 {
        color: #5c2e0f;
        font-size: 2em;
        margin-bottom: 10px;
      }

      .instructions {
        font-size: 0.95em;
        line-height: 1.6;
        margin-top: 10px;
      }

      .game-container {
        display: flex;
        flex-direction: row;
        gap: 15px;
        margin-bottom: 20px;
        align-items: flex-start;
        justify-content: center;
      }

      .left-section {
        display: flex;
        flex-direction: column;
        gap: 20px;
        width: 280px;
        min-width: 280px;
        max-width: 280px;
        flex-shrink: 0;
      }

      .stats-container {
        display: grid;
        grid-template-columns: 1fr;
        gap: 10px;
      }

      .stat-box {
        background-color: #fff8e7;
        border: 2px solid #8b4513;
        padding: 15px;
        border-radius: 8px;
        text-align: center;
      }

      .stat-label {
        font-size: 0.85em;
        font-weight: bold;
        margin-bottom: 5px;
      }

      .stat-value {
        font-size: 1.5em;
        color: #5c2e0f;
        font-weight: bold;
      }

      .timer-container {
        background-color: #fff8e7;
        border: 2px solid #8b4513;
        padding: 15px;
        border-radius: 8px;
      }

      .timer-label {
        font-size: 0.9em;
        font-weight: bold;
        margin-bottom: 8px;
        text-align: center;
      }

      .progress-bar {
        width: 100%;
        height: 25px;
        background-color: #f4ead5;
        border: 2px solid #8b4513;
        border-radius: 5px;
        overflow: hidden;
        position: relative;
      }

      .progress-fill {
        height: 100%;
        background-color: #8b4513;
        transition: width 1s linear;
        display: flex;
        align-items: center;
        justify-content: center;
        color: #fff8e7;
        font-weight: bold;
        font-size: 0.85em;
      }

      .hint-container {
        background-color: #fff8e7;
        border: 2px solid #8b4513;
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        text-align: center;
      }

      .hint-info {
        font-size: 0.9em;
        margin-bottom: 10px;
        font-weight: bold;
      }

      .grid-container {
        background-color: #fff8e7;
        border: 3px solid #8b4513;
        padding: 15px;
        border-radius: 10px;
        overflow-x: auto;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-shrink: 0;
        margin-top: 0;
      }

      .word-grid {
        display: grid;
        grid-template-columns: repeat(15, 35px);
        gap: 8px;
        user-select: none;
        width: fit-content;
      }

      .grid-cell {
        width: 35px;
        height: 35px;
        border: 1px solid #8b4513;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        font-size: 0.9em;
        cursor: pointer;
        background-color: #f4ead5;
        transition: all 0.2s;
      }

      .grid-cell:hover {
        background-color: #e8d9ba;
      }

      .grid-cell.selected {
        background-color: #d4a574;
        color: #fff;
      }

      .grid-cell.found {
        background-color: #8b4513;
        color: #fff8e7;
        animation: cellFound 0.5s ease;
      }

      .grid-cell.hint {
        background-color: #ffd700;
        animation: pulse 1s ease-in-out;
      }

      @keyframes cellFound {
        0% {
          transform: scale(1);
        }

        50% {
          transform: scale(1.2);
        }

        100% {
          transform: scale(1);
        }
      }

      @keyframes pulse {
        0%,
        100% {
          transform: scale(1);
          opacity: 1;
        }

        50% {
          transform: scale(1.1);
          opacity: 0.8;
        }
      }

      @keyframes celebrate {
        0% {
          transform: translateY(0) rotate(0deg);
        }

        25% {
          transform: translateY(-10px) rotate(5deg);
        }

        75% {
          transform: translateY(-10px) rotate(-5deg);
        }

        100% {
          transform: translateY(0) rotate(0deg);
        }
      }

      @keyframes fadeInScale {
        from {
          opacity: 0;
          transform: scale(0.5);
        }

        to {
          opacity: 1;
          transform: scale(1);
        }
      }

      @keyframes fadeOut {
        from {
          opacity: 1;
        }
        to {
          opacity: 0;
        }
      }

      @keyframes confetti {
        0% {
          transform: translateY(0) rotate(0deg);
          opacity: 1;
        }

        100% {
          transform: translateY(500px) rotate(720deg);
          opacity: 0;
        }
      }

      @keyframes shake {
        0%,
        100% {
          transform: translateX(0);
        }

        25% {
          transform: translateX(-5px);
        }

        75% {
          transform: translateX(5px);
        }
      }

      @keyframes glow {
        0%,
        100% {
          box-shadow: 0 0 5px #ffd700, 0 0 10px #ffd700;
        }

        50% {
          box-shadow: 0 0 20px #ffd700, 0 0 30px #ffd700, 0 0 40px #ffd700;
        }
      }

      @keyframes popIn {
        0% {
          opacity: 0;
          transform: translate(-50%, -50%) scale(0.5);
        }
        50% {
          opacity: 1;
          transform: translate(-50%, -50%) scale(1.1);
        }
        100% {
          opacity: 1;
          transform: translate(-50%, -50%) scale(1);
        }
      }

      .confetti-piece {
        position: fixed;
        width: 10px;
        height: 10px;
        z-index: 1001;
        pointer-events: none;
        animation: confetti 3s ease-out forwards;
      }

      .word-item.found-animate {
        animation: shake 0.5s ease, glow 1s ease;
      }

      .word-list {
        background-color: #fff8e7;
        border: 3px solid #8b4513;
        padding: 20px;
        border-radius: 10px;
        width: 280px;
        min-width: 280px;
        max-width: 280px;
        max-height: 674px;
        overflow-y: auto;
        flex-shrink: 0;
      }

      .word-list::-webkit-scrollbar {
        width: 10px;
      }

      .word-list::-webkit-scrollbar-track {
        background: #f4ead5;
        border-radius: 5px;
        margin: 5px 0;
      }

      .word-list::-webkit-scrollbar-thumb {
        background: #8b4513;
        border-radius: 5px;
        border: 2px solid #f4ead5;
      }

      .word-list::-webkit-scrollbar-thumb:hover {
        background: #5c2e0f;
      }

      .word-list h3 {
        color: #5c2e0f;
        margin-bottom: 15px;
        text-align: center;
      }

      .word-item {
        padding: 8px 12px;
        margin-bottom: 8px;
        border: 2px solid #8b4513;
        border-radius: 5px;
        background-color: #f4ead5;
        transition: all 0.3s;
      }

      .word-item.found {
        background-color: #8b4513;
        color: #fff8e7;
        text-decoration: line-through;
        animation: celebrate 0.6s ease;
      }

      .controls {
        text-align: center;
        margin-bottom: 20px;
      }

      .controls-wrapper {
        display: flex;
        justify-content: center;
        margin-bottom: 0;
      }

      .start-button-container {
        text-align: center;
        margin: 20px 0;
        width: 100%;
      }

      button {
        background-color: #8b4513;
        color: #fff8e7;
        border: none;
        padding: 12px 30px;
        font-size: 1em;
        border-radius: 5px;
        cursor: pointer;
        font-family: "Georgia", serif;
        margin: 0 10px;
        transition: all 0.3s;
      }

      button:hover {
        background-color: #5c2e0f;
        transform: translateY(-2px);
      }

      button:disabled {
        background-color: #ccc;
        cursor: not-allowed;
        transform: none;
      }

      /* Improved success message animation */
      .success-message {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%) scale(0.8);
        background-color: #fff8e7;
        border: 4px solid #8b4513;
        padding: 30px 50px;
        border-radius: 15px;
        font-size: 1.5em;
        font-weight: bold;
        color: #5c2e0f;
        z-index: 1002;
        animation: popIn 0.5s ease forwards;
        display: none;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        text-align: center;
        max-width: 90%;
      }

      .overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(109, 106, 106, 0.7);
        z-index: 1001;
        display: none;
      }

      /* Modal Styles */
      .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        z-index: 1003;
        align-items: center;
        justify-content: center;
      }

      .modal-content {
        background-color: #fff8e7;
        border: 3px solid #8b4513;
        border-radius: 10px;
        padding: 30px;
        width: 90%;
        max-width: 500px;
        text-align: center;
        animation: fadeInScale 0.3s ease;
      }

      .modal h3 {
        color: #5c2e0f;
        margin-bottom: 20px;
        font-size: 1.5em;
      }

      .modal p {
        margin-bottom: 25px;
        font-size: 1.1em;
        line-height: 1.5;
        white-space: pre-line;
      }

      .modal-buttons {
        display: flex;
        justify-content: center;
        gap: 15px;
      }

      .modal-btn {
        padding: 12px 25px;
        min-width: 120px;
        background-color: #8b4513;
        color: #fff8e7;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        font-family: "Georgia", serif;
        transition: all 0.3s;
      }

      .modal-btn:hover {
        background-color: #5c2e0f;
        transform: translateY(-2px);
      }

      .modal-btn.cancel {
        background-color: #6c757d;
      }

      .modal-btn.cancel:hover {
        background-color: #5a6268;
      }

      /* Game End Modal */
      .game-end-modal .modal-content {
        background-color: #fff8e7;
        border: 3px solid #28a745;
      }

      .game-end-modal h3 {
        color: #28a745;
      }

      .game-end-score {
        font-size: 1.3em;
        font-weight: bold;
        color: #5c2e0f;
        margin: 15px 0;
      }

      /* Back button styles */
      .back-btn-container {
        margin-bottom: 20px;
        margin-right: 20px;
        margin-top: 25px;
      }

      .back-btn {
        background-color: #5c2e0f;
        color: #f4ead5;
        padding: 10px 20px;
        border: 2px solid #8b4513;
        border-radius: 5px;
        text-decoration: none;
        font-size: 0.9em;
        font-family: "Times New Roman", serif;
        letter-spacing: 1px;
        transition: all 0.3s ease;
        width: 100%;
        text-align: center;
        display: block;
      }

      .back-btn:hover {
        background-color: #8b4513;
        color: #fff;
        transform: translateY(-2px);
      }

      /* Countdown Animation Styles */
      .countdown-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.8);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 9999;
        pointer-events: none;
      }

      .countdown-number {
        font-size: 20vw;
        font-weight: bold;
        color: #fff8e7;
        text-shadow: 0 0 20px #ffd700, 0 0 40px #ffd700, 0 0 60px #ffd700;
        animation: countdownPop 1s ease-out forwards;
        opacity: 0;
        font-family: "Garamond", "Georgia", serif;
      }

      .countdown-start {
        font-size: 10vw;
        font-weight: bold;
        color: #ffd700;
        text-shadow: 0 0 20px #8b4513, 0 0 40px #8b4513;
        animation: startPulse 2s ease-in-out infinite;
        font-family: "Garamond", "Georgia", serif;
        position: relative;
      }

      .countdown-start::after {
        content: "!";
        animation: exclamationPop 1s ease-in-out infinite;
      }

      @keyframes countdownPop {
        0% {
          opacity: 0;
          transform: scale(0.1) rotate(-360deg);
        }
        50% {
          opacity: 1;
          transform: scale(1.2) rotate(10deg);
        }
        100% {
          opacity: 1;
          transform: scale(1) rotate(0deg);
        }
      }

      @keyframes startPulse {
        0%,
        100% {
          transform: scale(1);
          text-shadow: 0 0 20px #8b4513, 0 0 40px #8b4513;
        }
        50% {
          transform: scale(1.1);
          text-shadow: 0 0 30px #ffd700, 0 0 60px #ffd700, 0 0 80px #ffd700;
        }
      }

      @keyframes exclamationPop {
        0%,
        100% {
          opacity: 1;
          transform: scale(1);
        }
        50% {
          opacity: 0.8;
          transform: scale(1.3);
        }
      }

      @media (max-width: 1024px) {
        .game-container {
          flex-direction: column;
          align-items: center;
        }

        .left-section {
          width: 100%;
          max-width: 100%;
          min-width: 100%;
          order: 1;
        }

        .word-list {
          width: 100%;
          max-width: 100%;
          min-width: 100%;
          max-height: 300px;
          order: 2;
        }

        .grid-container {
          order: 3;
        }

        .start-button-container {
          order: 0;
          margin-bottom: 10px;
        }

        .word-grid {
          grid-template-columns: repeat(15, 30px);
          gap: 6px;
        }

        .grid-cell {
          width: 30px;
          height: 30px;
          font-size: 0.8em;
        }
      }

      @media (max-width: 768px) {
        body {
          padding: 10px;
        }

        .container {
          padding: 0 5px;
        }

        header {
          padding: 15px;
          margin-bottom: 15px;
        }

        h1 {
          font-size: 1.3em;
          margin-bottom: 8px;
        }

        .instructions {
          font-size: 0.9em;
        }

        .stats-container {
          grid-template-columns: 1fr;
        }

        .game-container {
          flex-direction: column;
          align-items: center;
          gap: 10px;
        }

        .word-grid {
          grid-template-columns: repeat(15, 28px);
          gap: 5px;
        }

        .grid-cell {
          width: 28px;
          height: 28px;
          font-size: 0.7em;
          border: 1px solid #8b4513;
        }

        .grid-container {
          padding: 10px;
          margin-bottom: 15px;
        }

        .word-list {
          max-height: 250px;
          padding: 15px;
          border: 2px solid #8b4513;
          width: 100%;
          max-width: 100%;
          min-width: 100%;
        }

        .word-list h3 {
          font-size: 0.95em;
          margin-bottom: 10px;
        }

        .word-item {
          padding: 6px 10px;
          margin-bottom: 6px;
          font-size: 0.9em;
          border: 1px solid #8b4513;
        }

        button {
          padding: 10px 20px;
          font-size: 0.9em;
          margin: 5px;
        }

        .controls-wrapper {
          order: 1;
          width: 100%;
        }

        .controls {
          margin-top: 15px;
          margin-bottom: 20px;
        }

        .game-container {
          margin-top: 0;
        }
      }

      @media (max-width: 480px) {
        body {
          padding: 6px;
        }

        .container {
          padding: 0 3px;
        }

        header {
          padding: 10px;
          border: 2px solid #8b4513;
          margin-bottom: 10px;
        }

        h1 {
          font-size: 1.1em;
          margin-bottom: 5px;
        }

        .instructions {
          font-size: 0.8em;
          line-height: 1.4;
        }

        .stat-box {
          padding: 10px;
          border: 1px solid #8b4513;
        }

        .stat-label {
          font-size: 0.75em;
        }

        .stat-value {
          font-size: 1.2em;
        }

        .timer-container {
          padding: 10px;
          border: 1px solid #8b4513;
        }

        .hint-container {
          padding: 10px;
          border: 1px solid #8b4513;
          margin-bottom: 10px;
        }

        .hint-info {
          font-size: 0.8em;
        }

        .left-section {
          width: 100%;
          max-width: 100%;
          min-width: 100%;
          gap: 10px;
        }

        .word-grid {
          grid-template-columns: repeat(15, 20px);
          gap: 2px;
        }

        .grid-cell {
          width: 20px;
          height: 20px;
          font-size: 0.6em;
          border-width: 1px;
          border: 1px solid #8b4513;
          padding: 0;
        }

        .grid-container {
          padding: 6px;
          border: 2px solid #8b4513;
          margin-bottom: 10px;
          width: 100%;
          min-height: auto;
          flex-shrink: 1;
        }

        .word-list {
          max-height: 180px;
          padding: 10px;
          border: 2px solid #8b4513;
          margin-bottom: 0;
          width: 100%;
          max-width: 100%;
          min-width: 100%;
        }

        .word-list h3 {
          font-size: 0.85em;
          margin-bottom: 6px;
        }

        .word-item {
          padding: 4px 6px;
          margin-bottom: 4px;
          font-size: 0.8em;
          border: 1px solid #8b4513;
        }

        .word-item.found {
          font-size: 0.8em;
        }

        button {
          padding: 8px 12px;
          font-size: 0.8em;
          margin: 3px;
        }

        .controls-wrapper {
          order: 1;
          width: 100%;
          margin-bottom: 10px;
        }

        .controls {
          margin-top: 0;
          margin-bottom: 0;
        }

        .game-container {
          margin-top: 0;
          margin-bottom: 0;
          gap: 8px;
          flex-direction: column;
        }

        .success-message {
          padding: 15px 25px;
          font-size: 1.1em;
          border: 3px solid #8b4513;
          max-width: 85vw;
        }
      }

      @media (max-width: 373px) {
        body {
          padding: 4px;
        }

        .container {
          padding: 0 2px;
        }

        header {
          padding: 8px;
          border: 2px solid #8b4513;
          margin-bottom: 8px;
        }

        h1 {
          font-size: 0.95em;
          margin-bottom: 4px;
        }

        .instructions {
          font-size: 0.75em;
          line-height: 1.3;
        }

        .stat-box {
          padding: 8px;
          border: 1px solid #8b4513;
        }

        .stat-label {
          font-size: 0.7em;
        }

        .stat-value {
          font-size: 1.1em;
        }

        .timer-container {
          padding: 8px;
          border: 1px solid #8b4513;
        }

        .timer-label {
          font-size: 0.8em;
        }

        .progress-bar {
          height: 22px;
        }

        .progress-fill {
          font-size: 0.75em;
        }

        .hint-container {
          padding: 8px;
          border: 1px solid #8b4513;
          margin-bottom: 8px;
        }

        .hint-info {
          font-size: 0.75em;
        }

        .left-section {
          width: 100%;
          max-width: 100%;
          min-width: 100%;
          gap: 8px;
        }

        .word-grid {
          grid-template-columns: repeat(15, 18px);
          gap: 5px;
        }

        .grid-cell {
          width: 18px;
          height: 18px;
          font-size: 0.55em;
          border: 1px solid #8b4513;
          padding: 0;
        }

        .grid-container {
          padding: 4px;
          border: 1px solid #8b4513;
          margin-bottom: 8px;
          width: 100%;
        }

        .word-list {
          max-height: 160px;
          padding: 8px;
          border: 1px solid #8b4513;
          margin-bottom: 0;
          width: 100%;
        }

        .word-list h3 {
          font-size: 0.8em;
          margin-bottom: 4px;
        }

        .word-item {
          padding: 3px 5px;
          margin-bottom: 3px;
          font-size: 0.75em;
          border: 1px solid #8b4513;
        }

        button {
          padding: 6px 10px;
          font-size: 0.75em;
          margin: 2px;
        }

        .controls-wrapper {
          margin-bottom: 8px;
        }

        .controls {
          margin-top: 0;
          margin-bottom: 0;
        }

        .game-container {
          gap: 7px;
          margin-bottom: 0;
        }

        .success-message {
          padding: 12px 20px;
          font-size: 1em;
          border: 2px solid #8b4513;
          max-width: 90vw;
        }
      }
    </style>
  </head>

  <body>
    <div class="overlay" id="overlay"></div>

    <!-- Countdown Animation Overlay -->
    <div class="countdown-overlay" id="countdownOverlay"></div>

    <!-- Reset Confirmation Modal -->
    <div class="modal" id="resetModal">
      <div class="modal-content">
        <h3>Kumpirmasyon</h3>
        <p>
          Mayroon kang kasalukuyang laro na in progress. Sigurado ka bang gusto
          mong bumalik sa Mga Gawain? Ang iyong kasalukuyang iskor ay mabubura.
        </p>
        <div class="modal-buttons">
          <button class="modal-btn cancel" onclick="closeModal('resetModal')">
            Kanselahin
          </button>
          <button class="modal-btn" onclick="confirmBackToActivities()">
            Oo, Bumalik
          </button>
        </div>
      </div>
    </div>

    <!-- Game End Modal -->
    <div class="modal game-end-modal" id="gameEndModal">
      <div class="modal-content">
        <h3 id="gameEndTitle">Tapos na ang Laro!</h3>
        <p id="gameEndMessage"></p>
        <div class="game-end-score" id="gameEndScore"></div>
        <div class="modal-buttons">
          <button class="modal-btn" onclick="goToActivities()">
            Bumalik sa Mga Gawain
          </button>
        </div>
      </div>
    </div>

    <!-- Retry Confirmation Modal -->
    <div class="modal" id="retryModal">
      <div class="modal-content">
        <h3>Kumpirmasyon</h3>
        <p>
          Sigurado ka bang gusto mong gawin muli ang Gawain 1? Ang iyong
          kasalukuyang iskor ay mabubura at magsisimula ka mula sa simula.
        </p>
        <div class="modal-buttons">
          <button class="modal-btn cancel" onclick="closeModal('retryModal')">
            Kanselahin
          </button>
          <button class="modal-btn" onclick="confirmRetry()">
            Oo, Gawin Muli
          </button>
        </div>
      </div>
    </div>

    <div class="container">
      <header>
        <h1>El Filibusterismo - Word Search</h1>
        <div class="instructions">
          <strong>GAWAIN 1 - Panuto:</strong> Hanapin ang mga salita sa listahan
          na maaaring makita nang pahalang, patayo, o diagonal. Markahan ang
          buong salita mula simula hanggang katapusan kapag nahanap.
        </div>
      </header>

      <!-- Centered start button above the grid -->
      <div class="start-button-container">
        <div class="controls-wrapper">
          <button onclick="startWithCountdown()" id="startButton">
            Magsimula
          </button>
        </div>
      </div>

      <div class="game-container">
        <div class="left-section">
          <!-- Back button moved here -->
          <div class="back-btn-container">
            <button onclick="showBackToActivitiesModal()" class="back-btn">
              ‚Üê Bumalik sa Mga Gawain
            </button>
          </div>

          <div class="stats-container">
            <div class="stat-box">
              <div class="stat-label">Nahanap</div>
              <div class="stat-value" id="foundCount">0/15</div>
            </div>
          </div>

          <div class="timer-container">
            <div class="timer-label">Oras na Natitira</div>
            <div class="progress-bar">
              <div class="progress-fill" id="progressFill">30:00</div>
            </div>
          </div>

          <div class="hint-container">
            <div class="hint-info">
              Mga Hint: <span id="hintsRemaining">2</span>
            </div>
            <button onclick="useHint()" id="hintButton">Gumamit ng Hint</button>
          </div>
        </div>

        <div class="grid-container">
          <div class="word-grid" id="wordGrid"></div>
        </div>

        <div class="word-list">
          <h3>Mga Tauhang Hahanapin:</h3>
          <div id="wordList"></div>
        </div>
      </div>
    </div>

    <script>
      const GRID_SIZE = 15;
      const TOTAL_TIME = 1800; // 30 minutes in seconds
      const words = [
        "SIMOUN",
        "CUSTODIO",
        "BENZAYB",
        "VICTORINA",
        "KAPITAN",
        "IRENE",
        "SALVI",
        "BASILIO",
        "ISAGANI",
        "FLORENTINO",
        "PAULITA",
        "IBARRA",
        "RAFAEL",
        "MARIACLARA",
        "ELIAS",
      ];

      let grid = [];
      let placedWords = [];
      let selectedCells = [];
      let foundWords = new Set();
      let score = 0;
      let timeRemaining = TOTAL_TIME;
      let timerInterval = null;
      let isSelecting = false;
      let hintsRemaining = 3;
      let gameStarted = false;
      let currentGameScore = 0;
      let isShowingSuccessMessage = false;

      // Local storage keys
      const SCORE_KEY = "activity1_score";
      const COMPLETED_KEY = "activity1_completed";
      const LAST_SCORE_KEY = "activity1_last_score";

      // Countdown Animation Function
      // Update the showCountdownAnimation function in activity1.html
      function showCountdownAnimation(callback) {
        const overlay = document.getElementById("countdownOverlay");
        overlay.style.display = "flex";
        overlay.innerHTML = "";

        // Add mobile-specific class
        if (window.innerWidth <= 768) {
          overlay.classList.add("mobile-countdown");
        }

        let count = 3;

        function showNumber(num) {
          overlay.innerHTML = `<div class="countdown-number">${num}</div>`;

          if (num === 0) {
            // Show "START!"
            setTimeout(() => {
              overlay.innerHTML = `<div class="countdown-start">MAGSIMULA</div>`;

              // After "START" is shown, hide overlay and execute callback
              setTimeout(() => {
                overlay.style.display = "none";
                overlay.innerHTML = "";
                overlay.classList.remove("mobile-countdown");
                if (callback) callback();
              }, 1000);
            }, 1000);
          } else {
            // Show next number
            setTimeout(() => {
              showNumber(num - 1);
            }, 1000);
          }
        }

        // Start the countdown
        showNumber(count);
      }

      function startWithCountdown() {
        showCountdownAnimation(() => {
          startGame();
        });
      }

      function initGrid() {
        grid = Array(GRID_SIZE)
          .fill(null)
          .map(() => Array(GRID_SIZE).fill(""));
        placedWords = [];

        const sortedWords = [...words].sort((a, b) => b.length - a.length);

        sortedWords.forEach((word) => {
          let placed = false;
          let attempts = 0;
          while (!placed && attempts < 100) {
            const direction = Math.floor(Math.random() * 8);
            const row = Math.floor(Math.random() * GRID_SIZE);
            const col = Math.floor(Math.random() * GRID_SIZE);

            if (canPlaceWord(word, row, col, direction)) {
              placeWord(word, row, col, direction);
              placed = true;
            }
            attempts++;
          }
        });

        for (let i = 0; i < GRID_SIZE; i++) {
          for (let j = 0; j < GRID_SIZE; j++) {
            if (grid[i][j] === "") {
              grid[i][j] = String.fromCharCode(
                65 + Math.floor(Math.random() * 26)
              );
            }
          }
        }
      }

      function canPlaceWord(word, row, col, direction) {
        const directions = [
          [0, 1],
          [1, 0],
          [1, 1],
          [-1, 1],
          [0, -1],
          [-1, 0],
          [-1, -1],
          [1, -1],
        ];
        const [dx, dy] = directions[direction];

        for (let i = 0; i < word.length; i++) {
          const newRow = row + dx * i;
          const newCol = col + dy * i;

          if (
            newRow < 0 ||
            newRow >= GRID_SIZE ||
            newCol < 0 ||
            newCol >= GRID_SIZE
          ) {
            return false;
          }

          if (grid[newRow][newCol] !== "" && grid[newRow][newCol] !== word[i]) {
            return false;
          }
        }
        return true;
      }

      function placeWord(word, row, col, direction) {
        const directions = [
          [0, 1],
          [1, 0],
          [1, 1],
          [-1, 1],
          [0, -1],
          [-1, 0],
          [-1, -1],
          [1, -1],
        ];
        const [dx, dy] = directions[direction];
        const positions = [];

        for (let i = 0; i < word.length; i++) {
          const newRow = row + dx * i;
          const newCol = col + dy * i;
          grid[newRow][newCol] = word[i];
          positions.push([newRow, newCol]);
        }

        placedWords.push({ word, positions });
      }

      function renderGrid() {
        const gridEl = document.getElementById("wordGrid");
        gridEl.innerHTML = "";

        for (let i = 0; i < GRID_SIZE; i++) {
          for (let j = 0; j < GRID_SIZE; j++) {
            const cell = document.createElement("div");
            cell.className = "grid-cell";
            cell.textContent = grid[i][j];
            cell.dataset.row = i;
            cell.dataset.col = j;

            // Mouse events for desktop
            cell.addEventListener("mousedown", startSelection);
            cell.addEventListener("mouseenter", continueSelection);
            cell.addEventListener("mouseup", endSelection);

            // Touch events for mobile
            cell.addEventListener("touchstart", handleTouchStart);
            cell.addEventListener("touchmove", handleTouchMove);
            cell.addEventListener("touchend", handleTouchEnd);

            // Prevent default touch behaviors
            cell.addEventListener(
              "touchstart",
              function (e) {
                if (gameStarted) {
                  e.preventDefault();
                }
              },
              { passive: false }
            );

            gridEl.appendChild(cell);
          }
        }
      }

      // Touch event variables
      let touchStartCell = null;
      let touchIsSelecting = false;

      function handleTouchStart(e) {
        if (timerInterval === null || !gameStarted) return;
        e.preventDefault();

        const touch = e.touches[0];
        const cell = document.elementFromPoint(touch.clientX, touch.clientY);

        if (cell && cell.classList.contains("grid-cell")) {
          touchStartCell = cell;
          touchIsSelecting = true;
          selectedCells = [];

          // Clear previous selections
          document.querySelectorAll(".grid-cell.selected").forEach((c) => {
            c.classList.remove("selected");
          });

          addToSelection(cell);
        }
      }

      function handleTouchMove(e) {
        if (!touchIsSelecting || !gameStarted) return;
        e.preventDefault();

        const touch = e.touches[0];
        const cell = document.elementFromPoint(touch.clientX, touch.clientY);

        if (cell && cell.classList.contains("grid-cell")) {
          // Don't add the same cell multiple times
          if (!selectedCells.some((c) => c.element === cell)) {
            addToSelection(cell);
          }
        }
      }

      function handleTouchEnd(e) {
        if (!touchIsSelecting || !gameStarted) return;
        e.preventDefault();

        touchIsSelecting = false;
        touchStartCell = null;

        // Check the selected word
        const selectedWord = selectedCells
          .map((c) => grid[c.row][c.col])
          .join("");

        checkWord(selectedWord);

        // Clear selection after a delay
        setTimeout(() => {
          selectedCells.forEach((c) => c.element.classList.remove("selected"));
          selectedCells = [];
        }, 300);
      }

      // Add mobile-specific CSS to prevent text selection
      const style = document.createElement("style");
      style.textContent = `
  .grid-cell {
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    -webkit-touch-callout: none;
    -webkit-tap-highlight-color: transparent;
  }
  
  /* Improve touch target size on mobile */
  @media (max-width: 768px) {
    .grid-cell {
      min-width: 28px;
      min-height: 28px;
      display: flex;
      align-items: center;
      justify-content: center;
      touch-action: none;
    }
    
    .word-grid {
      touch-action: none;
    }
    
    .grid-container {
      -webkit-overflow-scrolling: touch;
      overflow-scrolling: touch;
    }
  }
  
  @media (max-width: 480px) {
    .grid-cell {
      min-width: 22px;
      min-height: 22px;
    }
  }
`;
      document.head.appendChild(style);

      function renderWordList() {
        const listEl = document.getElementById("wordList");
        listEl.innerHTML = "";

        words.forEach((word, index) => {
          const item = document.createElement("div");
          item.className = "word-item";
          item.textContent = `${index + 1}. ${word}`;
          item.id = `word-${word}`;
          listEl.appendChild(item);
        });
      }

      function startSelection(e) {
        if (timerInterval === null || !gameStarted) return;
        isSelecting = true;
        selectedCells = [];
        document.querySelectorAll(".grid-cell.selected").forEach((cell) => {
          cell.classList.remove("selected");
        });
        addToSelection(e.target);
      }

      function continueSelection(e) {
        if (isSelecting && gameStarted) {
          addToSelection(e.target);
        }
      }

      function addToSelection(cell) {
        const row = parseInt(cell.dataset.row);
        const col = parseInt(cell.dataset.col);

        if (!selectedCells.some((c) => c.row === row && c.col === col)) {
          selectedCells.push({ row, col, element: cell });
          cell.classList.add("selected");
        }
      }

      function endSelection() {
        if (!isSelecting || !gameStarted) return;
        isSelecting = false;

        const selectedWord = selectedCells
          .map((c) => grid[c.row][c.col])
          .join("");
        checkWord(selectedWord);

        setTimeout(() => {
          selectedCells.forEach((c) => c.element.classList.remove("selected"));
          selectedCells = [];
        }, 300);
      }

      function checkWord(selectedWord) {
        const foundWord = placedWords.find((pw) => {
          const word = pw.word;
          if (
            word !== selectedWord &&
            word !== selectedWord.split("").reverse().join("")
          ) {
            return false;
          }

          const positions = pw.positions;
          if (positions.length !== selectedCells.length) return false;

          const match = positions.every(
            (pos, i) =>
              (pos[0] === selectedCells[i].row &&
                pos[1] === selectedCells[i].col) ||
              (pos[0] === selectedCells[selectedCells.length - 1 - i].row &&
                pos[1] === selectedCells[selectedCells.length - 1 - i].col)
          );

          return match;
        });

        if (foundWord && !foundWords.has(foundWord.word)) {
          foundWords.add(foundWord.word);
          currentGameScore = foundWords.size;

          // Create confetti effect
          createConfetti();

          // Animate found cells with stagger
          foundWord.positions.forEach((pos, index) => {
            setTimeout(() => {
              const cell = document.querySelector(
                `[data-row="${pos[0]}"][data-col="${pos[1]}"]`
              );
              cell.classList.add("found");
            }, index * 50);
          });

          // Animate word list item with special effect
          setTimeout(() => {
            const wordItem = document.getElementById(`word-${foundWord.word}`);
            wordItem.classList.add("found-animate");
            setTimeout(() => {
              wordItem.classList.add("found");
            }, 500);
          }, 200);

          // Show success message
          showSuccessMessage(foundWord.word);

          updateStats();
        }
      }

      function showSuccessMessage(word) {
        if (isShowingSuccessMessage) return;

        isShowingSuccessMessage = true;

        const message = document.createElement("div");
        message.className = "success-message";
        message.textContent = `Nakita mo: ${word}! üéâ`;
        message.style.display = "block";

        const overlay = document.createElement("div");
        overlay.className = "overlay";
        overlay.style.display = "block";

        document.body.appendChild(overlay);
        document.body.appendChild(message);

        setTimeout(() => {
          message.style.animation = "fadeOut 0.3s ease forwards";
          overlay.style.animation = "fadeOut 0.3s ease forwards";

          setTimeout(() => {
            message.style.display = "none";
            overlay.style.display = "none";
            message.remove();
            overlay.remove();
            isShowingSuccessMessage = false;

            // Check if this was the last word before showing game end modal
            if (foundWords.size === words.length) {
              // Small delay to ensure success message is gone
              setTimeout(() => {
                endGame(true);
              }, 300);
            }
          }, 300);
        }, 1500);
      }

      function createConfetti() {
        const colors = ["#8b4513", "#d4a574", "#ffd700", "#fff8e7", "#5c2e0f"];
        const confettiCount = 30;

        for (let i = 0; i < confettiCount; i++) {
          const confetti = document.createElement("div");
          confetti.className = "confetti-piece";
          confetti.style.left = Math.random() * window.innerWidth + "px";
          confetti.style.top = "0px";
          confetti.style.backgroundColor =
            colors[Math.floor(Math.random() * colors.length)];
          confetti.style.animationDelay = Math.random() * 0.3 + "s";

          document.body.appendChild(confetti);

          setTimeout(() => {
            confetti.remove();
          }, 3000);
        }
      }

      function useHint() {
        if (
          hintsRemaining <= 0 ||
          timerInterval === null ||
          foundWords.size === words.length
        ) {
          return;
        }

        // Find an unfound word
        const unfoundWords = placedWords.filter(
          (pw) => !foundWords.has(pw.word)
        );
        if (unfoundWords.length === 0) return;

        const randomWord =
          unfoundWords[Math.floor(Math.random() * unfoundWords.length)];

        // Highlight first letter of the word
        const firstPos = randomWord.positions[0];
        const cell = document.querySelector(
          `[data-row="${firstPos[0]}"][data-col="${firstPos[1]}"]`
        );

        cell.classList.add("hint");
        setTimeout(() => {
          cell.classList.remove("hint");
        }, 2000);

        hintsRemaining--;
        document.getElementById("hintsRemaining").textContent = hintsRemaining;

        if (hintsRemaining === 0) {
          document.getElementById("hintButton").disabled = true;
        }
      }

      function updateStats() {
        document.getElementById(
          "foundCount"
        ).textContent = `${foundWords.size}/15`;
      }

      function startTimer() {
        if (timerInterval) clearInterval(timerInterval);
        timeRemaining = TOTAL_TIME;

        timerInterval = setInterval(() => {
          timeRemaining--;
          updateTimer();

          if (timeRemaining <= 0) {
            endGame(false);
          }
        }, 1000);
      }

      function updateTimer() {
        const minutes = Math.floor(timeRemaining / 60);
        const seconds = timeRemaining % 60;
        const timeText = `${minutes}:${seconds.toString().padStart(2, "0")}`;

        const percentage = (timeRemaining / TOTAL_TIME) * 100;
        const progressFill = document.getElementById("progressFill");
        progressFill.style.width = percentage + "%";
        progressFill.textContent = timeText;
      }

      function endGame(won) {
        if (timerInterval) {
          clearInterval(timerInterval);
          timerInterval = null;
        }

        gameStarted = false;

        // Save score to localStorage
        const finalScore = foundWords.size;
        localStorage.setItem(SCORE_KEY, finalScore);
        localStorage.setItem(COMPLETED_KEY, "true");

        // Don't save as last score if game was completed
        if (!won) {
          localStorage.setItem(LAST_SCORE_KEY, finalScore);
        }

        // Wait a bit if success message is showing
        if (isShowingSuccessMessage) {
          setTimeout(() => {
            showGameEndModal(won, finalScore);
          }, 500);
        } else {
          showGameEndModal(won, finalScore);
        }
      }

      function showGameEndModal(won, finalScore) {
        const title = document.getElementById("gameEndTitle");
        const message = document.getElementById("gameEndMessage");
        const scoreElement = document.getElementById("gameEndScore");

        if (won) {
          title.textContent = "Binabati kita!";
          message.textContent = `Nahanap mo lahat ng 15 salita!`;
          scoreElement.textContent = `Iskor: 15/15`;
        } else {
          title.textContent = "Tapos na ang oras!";
          message.textContent = `Nahanap: ${finalScore}/15`;
          scoreElement.textContent = `Iskor: ${finalScore}/15`;
        }

        showModal("gameEndModal");
      }

      function startGame() {
        gameStarted = true;
        foundWords.clear();
        selectedCells = [];
        hintsRemaining = 2;
        currentGameScore = 0;
        isShowingSuccessMessage = false;

        document.getElementById("hintsRemaining").textContent = hintsRemaining;
        document.getElementById("hintButton").disabled = false;

        initGrid();
        renderGrid();
        renderWordList();
        updateStats();
        startTimer();

        document.querySelectorAll(".grid-cell").forEach((cell) => {
          cell.classList.remove("found", "selected", "hint");
        });

        // Disable start button once game starts
        document.getElementById("startButton").disabled = true;
        document.getElementById("startButton").textContent =
          "Nagsimula na ang laro";
      }

      function showModal(modalId) {
        document.getElementById(modalId).style.display = "flex";
      }

      function closeModal(modalId) {
        document.getElementById(modalId).style.display = "none";
      }

      function showBackToActivitiesModal() {
        if (gameStarted) {
          showModal("resetModal");
        } else {
          window.location.href = "activities.html";
        }
      }

      function confirmBackToActivities() {
        // Save current progress as last score if game was in progress
        if (gameStarted && currentGameScore > 0) {
          localStorage.setItem(LAST_SCORE_KEY, currentGameScore);
        }
        closeModal("resetModal");
        window.location.href = "activities.html";
      }

      function confirmRetry() {
        // Clear localStorage for this activity
        localStorage.removeItem(SCORE_KEY);
        localStorage.removeItem(COMPLETED_KEY);
        localStorage.removeItem(LAST_SCORE_KEY);

        // Reset and start new game
        closeModal("retryModal");
        startGame();
      }

      function goToActivities() {
        closeModal("gameEndModal");
        window.location.href = "activities.html?score1=" + foundWords.size;
      }

      document.addEventListener("mouseup", () => {
        isSelecting = false;
      });

      window.onload = () => {
        initGrid();
        renderGrid();
        renderWordList();

        // Check if there's a saved score to resume
        const savedScore = localStorage.getItem(SCORE_KEY);
        const isCompleted = localStorage.getItem(COMPLETED_KEY);
        const lastScore = localStorage.getItem(LAST_SCORE_KEY);

        // Show the most recent score
        if (isCompleted === "true" && savedScore) {
          document.getElementById(
            "foundCount"
          ).textContent = `${savedScore}/15`;
          document.getElementById("startButton").textContent = "Gawin Muli";
          document.getElementById("startButton").disabled = false;
          document.getElementById("startButton").onclick = function () {
            showModal("retryModal");
          };
        } else if (lastScore) {
          // Show last known score from incomplete game
          document.getElementById("foundCount").textContent = `${lastScore}/15`;
          document.getElementById("startButton").textContent = "Magsimula";
          document.getElementById("startButton").disabled = false;
          document.getElementById("startButton").onclick = function () {
            startWithCountdown();
          };
        } else {
          document.getElementById("startButton").onclick = function () {
            startWithCountdown();
          };
        }
      };
    </script>
  </body>
</html>
