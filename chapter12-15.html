<!DOCTYPE html>
<html lang="tl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>El Filibusterismo - Kabanata XII-XV</title>
    <link rel="stylesheet" href="styles.css" />
    <style>
        h2 {
            color: #5c2e0f;
        }
        /* Small spacing and centered h2 titles for chapter pages */
        .chapter-block { margin-bottom: 30px; }
        .chapter-block h2 {
            margin: 10px 0 18px;
            text-align: center;
            font-weight: 600;
        }
        .chapter-content { padding-top: 6px; }
        /* Style for the single audio player at the end */
        .combined-audio-player {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid #ddd;
            text-align: center;
        }
        .combined-audio-player h3 {
            margin-bottom: 15px;
            color: #5c2e0f;
        }
    </style>
</head>
<body data-page="chapter-multi">
    <div class="container">
        <header>
            <h1>Kabanata 12–15</h1>
            <p class="subtitle">Pinagsamang Kabanata 12 hanggang 15</p>
        </header>

        <div class="content-section">
            <a href="chapters.html" class="back-button">← Bumalik sa Mga Kabanata</a>

            <div class="chapter-block" id="kabanata12">
                <h2>KABANATA XII: PLACIDO PENITENTE</h2>
                <div class="chapter-content">
                    <p>Malungkot na papasok sa Unibersidad ng Santo Tomas si Placido Penitente dahil gusto na niyang huminto sa pag-aaral. Dalawang beses na niyang isinulat ito sa kanyang ina, ngunit nakiusap ang ina na tapusin man lang niya ang kursong Bachelor of Arts dahil nasa ikaapat na taon na siya.</p>
                    <p>Pinagtatakhan ito ng kanyang mga kababayan sa Tanawan dahil kilala si Placido bilang pinakamatalino sa paaralan ni Padre Valerio. Wala siyang bisyo, wala ring iniintinding kasintahan, at may sapat na pera kaya walang malinaw na dahilan upang tumigil sa pag-aaral.</p>
                    <p>Habang naglalakad siya sa Magallanes, sinalubong siya ni Juanito Pelaez, isang mayabang at mayamang estudyante na paborito ng mga guro dahil siya'y anak ng mestisong Kastila. Ikinuwento ni Juanito ang masaya niyang bakasyon sa Tiyani kasama si Padre Camorra, kung saan sila raw ay namasyal at nangharana ng mga babae. Sinabi rin niya ang masasakit na salita laban kay Basilio at kay Huli, na ikinainis ni Placido.</p>
                    <p>Nagtanong si Juanito tungkol sa kanilang aralin dahil madalas ay walang klase may pista, kaarawan ng guro, o kaunting ulan lamang. Ang leksiyon daw nila ay tungkol sa mga salamin. Inanyayahan niya si Placido na gumala ngunit tumanggi ito. Humingi rin si Juanito ng abuloy para sa monumento ng isang paring Dominikano, at napilitan si Placido na magbigay dahil alam niyang nakatutulong ito upang makapasa ang estudyante.</p>
                    <p>Malapit na sa unibersidad, nakita nila si Isagani na nakikipagtalo tungkol sa aralin. Napatingin ang mga mag-aaral sa isang karwahed dumating kung saan naroon si Paulita Gomez, ang kasintahan ni Isagani, kasama si Doña Victorina. Natuwa si Isagani nang makita si Paulita. Samantala, si Tadeo, na pumapasok lamang upang alamin kung may klase, ay napilitang sumama kay Paulita sa simbahan.</p>
                    <p>Pagpasok sa paaralan, may tumawag kay Placido upang papirmahin siya sa isang kasulatang laban sa balak na paaralan nina Macaraig. Tumanggi siyang pumirma dahil wala siyang panahon na basahin ito at naalala niya ang isang kakilala na nawalan ng ari-arian dahil sa pagpirma sa dokumentong hindi niya binasa. Dahil dito, nahuli siya sa klase.</p>
                    <p>Pumasok si Placido sa silid-aralan nang may tapang at sadyang ipinakita ang kanyang presensya. Dahil mahigit isang daan ang estudyante, napansin siya ng guro at palihim na binalaan ng parusa dahil sa pagiging bastos.</p>
                    <p>Ipinaliwanag ni Placido na hindi makatarungan ang parusa at sinabi niyang hindi dapat markahan ang isang estudyanteng wala naman sa klase noong itinuro ang aralin. Ngunit tinawanan lamang siya ng guro at pinagsabihang pilosopo at walang galang. Dahil sa matinding galit at kahihiyan, ipinaglaban ni Placido ang kanyang dangal at umalis sa klase.</p>
                </div>
                <!-- REMOVED audio player for Kabanata 12 -->
            </div>

            <div class="chapter-block" id="kabanata13">
                <h2>KABANATA XIII: Ang Klase sa Pisika</h2>
                <div class="chapter-content">
                    <p>Ang silid-aralan ng pisika ay hugis-taluhaba, may mga upuang pataas na parang hagdan at nakapaligid sa tatlong gilid ng silid. Sa unahan ay naroon ang mesa ng guro at sa likod nito ang pisara na may nakasulat na "Viva!", na matagal nang hindi nabubura. Payak at malamig ang silid dahil bato ang mga dingding at walang palamuti. May mga gamit sa pisika ngunit nakatago lamang sa aparador at bihirang gamitin. Ipinapakita lamang ang mga ito sa mga dayuhan upang magmukhang mahusay ang pagtuturo sa UST, kahit sa totoo ay hindi naman natututo ang mga estudyante.</p>
                    <p>Ang guro ay si Padre Millon, isang batang paring Dominikano na kilala sa pilosopiya ngunit ngayon lamang nagtuturo ng pisika. Tinawag ng guro ang isang estudyanteng antok na antok. Parang makinang paulit-ulit lamang nitong binigkas ang isinaulong aralin tungkol sa salamin. Hindi ito naiintindihan ng guro kaya paulit-ulit niya itong pinatigil at tinanong, ngunit patuloy lamang ang estudyante sa pagbigkas ng kabisado niyang sagot. Dahil sa mga bulong at maling dikta ni Juanito Pelaez, lalo pang nalito ang estudyante at pinagtawanan ng klase pati ng guro.</p>
                    <p>Tinawag ni Padre Millon si Juanito Pelaez, ngunit sa pagmamadali nito ay natapakan niya si Placido Penitente. Dahil dito, si Placido ang napansin at siya ang tinanong ng guro tungkol sa aralin. Sinagot ni Placido ang mga tanong batay lamang sa sinasabi ng aklat. Gayunman, ginamitan siya ng guro ng pilosopiya at lohika upang ipahiya at ipakita na mali ang kanyang sagot. Nalito si Placido at siya ay minura at ininsulto ng guro sa harap ng klase. Tinawag pa siya ng ibang pangalan at sinabing paparusahan. Nang tingnan ang talaan, pinalabas ng guro na marami na raw liban si Placido at binantaan siyang mapapatalsik kapag nadagdagan pa ito.</p>
                    <p>Ipinaliwanag ni Placido na hindi makatarungan ang parusa at sinabi niyang hindi dapat markahan ang isang estudyanteng wada naman sa klase noong itinuro ang aralin. Ngunit tinawanan lamang siya ng guro at pinagsabihang pilosopo at walang galang. Dahil sa matinding galit at kahihiyan, ipinaglaban ni Placido ang kanyang dangal. Pagkatapos nito, bigla siyang umalis sa klase. Nagulat ang lahat ng estudyante sa kanyang ginawa. Nagalit si Padre Millon at nagsermon, sinabing suwail si Placido at iniuugnay pa siya sa mga sumusuporta sa paaralan ng mga Kastila. Patuloy ang pagmumura ng pari hanggang sa tumunog na ang kampana. Sa huli, umalis ang mahigit dalawang daang estudyante na wala pa ring bagong natutunan.</p>
                </div>
                <!-- REMOVED audio player for Kabanata 13 -->
            </div>

            <div class="chapter-block" id="kabanata14">
                <h2>KABANATA XIV: Sa Bahay ng mga Estudyante</h2>
                <div class="chapter-content">
                    <p>Ang kabanatang ito ay naganap sa bahay ni Macaraig, isang malaking tirahan ng mga estudyante. Sa umaga ay tahimik ang bahay ngunit pagsapit ng hapon ay nagiging magulo at puno ng tawanan. Ipinakita rito ang iba't ibang ginagawa ng mga estudyante tulad ng pagtugtog ng musika, pagsusugal, pag-aaral, pagsusulat, pag-aaway, at pagbibiruan. Mayroon ding nagtitindang Intsik na madalas pagtripan ng mga estudyante ngunit masaya pa rin dahil binabayaran siya.</p>
                    <p>Naging seryoso ang usapan nang dumating sina Isagani at Sandoval. Pinag-usapan nila ang panukalang pagpapatayo ng paaralan. Sina Isagani, Sandoval, at Pelaez ay naniniwalang may pag-asa itong matupad, ngunit si Pecson ay nagbabala na maaaring tutulan ito ng pamahalaan at ng simbahan at baka maparusahan pa ang mga nagpanukala.</p>
                    <p>Nagkaroon ng mainit na pagtatalo tungkol sa pamahalaang Kastila, sa simbahan, at sa sistema ng edukasyon. Ayon kay Pecson, maaaring tutulan ang paaralan dahil matatakot ang mga namumuno na magkaisa ang mga Pilipino kapag nagkaroon ng iisang wika at kaalaman sa batas. Samantala, ipinagtanggol naman ni Sandoval ang Espanya at sinabing marami na itong naibigay sa Pilipinas.</p>
                </div>
                <!-- REMOVED audio player for Kabanata 14 -->
            </div>

            <div class="chapter-block" id="kabanata15">
                <h2>KABANATA XV: Si Ginoong Pasta</h2>
                <div class="chapter-content">
                    <p>Nagtungo si Isagani kay Ginoong Pasta upang humingi ng tulong para sa panukalang paaralan ng mga estudyante. Kilala si G. Pasta bilang abogadong madalas lapitan ng mga prayle at may malaking impluwensiya. Matagal munang naghintay si Isagani bago siya hinarap ng abugado.</p>
                    <p>Ipinaliwanag ni Isagani ang layunin ng paaralan at hiniling na tulungan niya silang payuhan si Don Custodio na paboran ang panukala. Nagkunwaring walang alam si G. Pasta, ngunit malinaw na tutol na siya rito. Sinabi niyang mahal niya ang bayan ngunit ayaw niyang mapahamak ang sarili dahil marami siyang iniingatang interes.</p>
                    <p>Naiwang nagmuni-muni si G. Pasta. Naalala niya ang sarili noong kabataan niya at naunawaan ang damdamin ni Isagani, ngunit pinili pa rin niyang manatili sa ligtas at pansariling panig.</p>
                </div>

                <!-- Single audio player for all chapters -->
                <div class="combined-audio-player">
                    <h3>Pakinggan ang Diyalog ng Kabanata 12-15</h3>
                    <div class="audio-controls">
                        <audio controls id="combinedChapterAudio" preload="auto">
                            <source src="audio/Kabanata 12 - 15.MP3" type="audio/mpeg">

                            Ang iyong browser ay hindi sumusuporta sa audio player.
                        </audio>
                       <p class="audio-note"><em>Ang audio ay magpe-play awtomatiko o maaaring ipagpatuloy mula sa huling posisyon.</em></p>
                    </div>
                </div>
            </div>
            <div class="chapter-navigation-container">
                <div class="chapter-navigation">
                    <button class="nav-btn next-btn" onclick="window.location.href='talasalitaan12-15.html'">
                        Magpatuloy sa Talasalitaan →
                    </button>
                </div>
            </div>
        </div>
    </div>
    <script src="script-chapters.js"></script>
    <script src="rain.js"></script>
    <script>
    // Auto-play script for combined chapter audio with state persistence
    document.addEventListener('DOMContentLoaded', function() {
        const audioElement = document.getElementById('combinedChapterAudio');
        if (!audioElement) return;

        // Set up audio element ID for state tracking
        if (!audioElement.id) {
            audioElement.id = 'combinedAudio12-15';
        }

        // Load saved playback state
        loadAudioState(audioElement, '12-15');
        
        // Set up event listeners for state saving
        setupAudioEventListeners(audioElement, '12-15');
        
        // Try to auto-play with user interaction detection
        attemptAutoPlay(audioElement, '12-15');
        
        // Also try to play when page becomes visible again
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden && audioElement.paused && 
                sessionStorage.getItem('userInteractedWithAudio') === 'true') {
                attemptAutoPlay(audioElement, '12-15');
            }
        });
    });
    
    function loadAudioState(audioElement, chapterKey) {
        try {
            const savedTime = sessionStorage.getItem(`chapter${chapterKey}AudioPosition`);
            const savedIsPlaying = sessionStorage.getItem(`chapter${chapterKey}AudioIsPlaying`);
            const audioSource = sessionStorage.getItem(`chapter${chapterKey}AudioSource`);
            
            // Only restore if it's the same audio source
            const currentSource = audioElement.querySelector('source').src;
            if (savedTime && audioSource === currentSource) {
                const time = parseFloat(savedTime);
                const duration = audioElement.duration;
                
                // Only restore if position is valid and not too close to end
                if (!isNaN(time) && time > 0 && time < (duration || Infinity) - 1) {
                    audioElement.currentTime = time;
                }
                
                // Restore playback state
                if (savedIsPlaying === 'true' && audioElement.paused) {
                    sessionStorage.setItem(`shouldResumeAudio${chapterKey}`, 'true');
                }
            }
            
            // Save current source for future checks
            sessionStorage.setItem(`chapter${chapterKey}AudioSource`, currentSource);
        } catch (e) {
            console.error('Error loading audio state:', e);
        }
    }
    
    function setupAudioEventListeners(audioElement, chapterKey) {
        // Save playback position regularly
        audioElement.addEventListener('timeupdate', function() {
            if (!audioElement.paused && audioElement.currentTime > 0) {
                sessionStorage.setItem(`chapter${chapterKey}AudioPosition`, audioElement.currentTime);
            }
        });
        
        // Save play state
        audioElement.addEventListener('play', function() {
            sessionStorage.setItem(`chapter${chapterKey}AudioIsPlaying`, 'true');
            sessionStorage.setItem('userInteractedWithAudio', 'true');
        });
        
        audioElement.addEventListener('pause', function() {
            sessionStorage.setItem(`chapter${chapterKey}AudioIsPlaying`, 'false');
        });
        
        audioElement.addEventListener('ended', function() {
            sessionStorage.removeItem(`chapter${chapterKey}AudioPosition`);
            sessionStorage.removeItem(`chapter${chapterKey}AudioIsPlaying`);
            sessionStorage.removeItem(`shouldResumeAudio${chapterKey}`);
            // Update the note to show audio is finished
            const audioNote = document.querySelector('.audio-note');
            if (audioNote) {
                audioNote.innerHTML = '<em>Tapos na ang audio ng Kabanata XII-XV.</em>';
            }
        });
        
        // Save state before page unload
        window.addEventListener('beforeunload', function() {
            if (!audioElement.paused && audioElement.currentTime > 0) {
                sessionStorage.setItem(`chapter${chapterKey}AudioPosition`, audioElement.currentTime);
                sessionStorage.setItem(`chapter${chapterKey}AudioIsPlaying`, 'true');
            }
        });
        
        // Handle user interaction with audio element
        audioElement.addEventListener('click', function() {
            sessionStorage.setItem('userInteractedWithAudio', 'true');
        });
        
        audioElement.addEventListener('play', function() {
            sessionStorage.setItem('userInteractedWithAudio', 'true');
        });
        
        // Handle audio errors
        audioElement.addEventListener('error', function() {
            const audioControls = audioElement.closest('.audio-controls');
            if (audioControls) {
                const errorNote = document.createElement('p');
                errorNote.className = 'audio-note'; 
                errorNote.style.color = '#cc0000';
                errorNote.innerHTML = `<em>Hindi ma-play ang audio file. Paki-check kung naka-save bilang "Kabanata 12-15.mp3" sa audio folder.</em>`;
                audioControls.appendChild(errorNote);
            }
        });
    }
    
    function attemptAutoPlay(audioElement, chapterKey) {
        // Check if we should resume playback
        const shouldResume = sessionStorage.getItem(`shouldResumeAudio${chapterKey}`) === 'true';
        const userInteracted = sessionStorage.getItem('userInteractedWithAudio') === 'true';
        
        if (shouldResume || userInteracted) {
            // Small delay to ensure page is ready
            setTimeout(() => {
                const playPromise = audioElement.play();
                
                if (playPromise !== undefined) {
                    playPromise.catch(error => {
                        console.log('Auto-play prevented:', error);
                        
                        // Only show fallback if this is the first load
                        if (!userInteracted) {
                            showAutoplayFallback(audioElement, chapterKey);
                        }
                    }).then(() => {
                        // Clear the resume flag if successful
                        sessionStorage.removeItem(`shouldResumeAudio${chapterKey}`);
                        
                        // Update the note
                        const audioNote = document.querySelector('.audio-note');
                        if (audioNote) {
                            const currentTime = Math.floor(audioElement.currentTime);
                            audioNote.innerHTML = `<em>Nagpe-play ang audio mula ${formatTime(currentTime)}. I-refresh ang pahina upang ipagpatuloy mula dito.</em>`;
                        }
                    });
                }
            }, 300);
        } else {
            // First visit, show fallback button
            showAutoplayFallback(audioElement, chapterKey);
        }
    }
    
    function showAutoplayFallback(audioElement, chapterKey) {
        const audioContainer = audioElement.closest('.audio-controls');
        if (!audioContainer) return;
        
        // Remove any existing overlay
        const existingOverlay = audioContainer.querySelector('.autoplay-fallback');
        if (existingOverlay) existingOverlay.remove();
        
        const overlay = document.createElement('div');
        overlay.className = 'autoplay-fallback';
        overlay.style.marginTop = '15px';
        overlay.style.padding = '15px';
        overlay.style.backgroundColor = '#f8f3e9';
        overlay.style.borderRadius = '8px';
        overlay.style.border = '1px solid #e0d5c0';
        overlay.style.textAlign = 'center';
        
        // Check if there's saved position
        const savedTime = sessionStorage.getItem(`chapter${chapterKey}AudioPosition`);
        let timeInfo = '';
        if (savedTime) {
            const time = Math.floor(parseFloat(savedTime));
            timeInfo = `<p style="margin-bottom: 5px; color: #5c2e0f; font-size: 0.9em;">
                <strong>Naka-save na posisyon:</strong> ${formatTime(time)}
            </p>`;
        }
        
        overlay.innerHTML = `
            <p style="margin-bottom: 10px; color: #5c2e0f; font-size: 0.95em;">
                <strong>I-play ang Kabanata XII-XV</strong>
            </p>
            ${timeInfo}
            <button class="play-overlay-btn" 
                    onclick="resumeChapterAudio1215(this)"
                    style="background: linear-gradient(to bottom, #5c2e0f, #4a240c); 
                           color: white; padding: 10px 20px; border: none; 
                           border-radius: 6px; cursor: pointer; font-weight: bold;
                           font-size: 1em; box-shadow: 0 3px 5px rgba(0,0,0,0.2);
                           margin-top: 10px;">
                ▶ Simulan ang Audio
            </button>
            <p style="margin-top: 8px; font-size: 0.8em; color: #777;">
                Magpe-play mula sa simula o huling posisyon.
            </p>
        `;
        
        audioContainer.appendChild(overlay);
    }
    
    // Helper function to format time
    function formatTime(seconds) {
        const mins = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
    }
    
    // Global function for resume button (Kabanata 12-15)
    window.resumeChapterAudio1215 = function(button) {
        const audioElement = document.getElementById('combinedChapterAudio');
        if (audioElement) {
            audioElement.play().then(() => {
                const overlay = button.closest('.autoplay-fallback');
                if (overlay) overlay.remove();
                sessionStorage.setItem('userInteractedWithAudio', 'true');
                
                // Update the note
                const audioNote = document.querySelector('.audio-note');
                if (audioNote) {
                    const currentTime = Math.floor(audioElement.currentTime);
                    audioNote.innerHTML = `<em>Nagpe-play ang audio ng Kabanata XII-XV mula ${formatTime(currentTime)}.</em>`;
                }
            }).catch(error => {
                console.error('Playback failed:', error);
                alert('Hindi ma-play ang audio. Pakisubukan muli o i-check ang audio file.');
            });
        }
    };
</script>
</body>
</html>