<!DOCTYPE html>
<html lang="tl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>El Filibusterismo - Kabanata XXXIII–XXXV</title>
    <link rel="stylesheet" href="styles.css" />
    <style>
        h2 {
            color: #5c2e0f;
        }
        .chapter-block { margin-bottom: 30px; }
        .chapter-block h2 {
            margin: 10px 0 18px;
            text-align: center;
            font-weight: 600;
        }
        .chapter-content { padding-top: 6px; }
        /* Style for the single audio player at the end */
        .combined-audio-player {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid #ddd;
            text-align: center;
        }
        .combined-audio-player h3 {
            margin-bottom: 15px;
            color: #5c2e0f;
        }
    </style>
</head>
<body data-page="chapter-multi">
    <div class="container">
        <header>
            <h1>Kabanata 33–35</h1>
            <p class="subtitle">Pinagsamang Kabanata 33 hanggang 35</p>
        </header>

        <div class="content-section">
            <a href="chapters.html" class="back-button">← Bumalik sa Mga Kabanata</a>

            <!-- KABANATA 33 -->
            <div class="chapter-block" id="kabanata33">
                <h2>KABANATA XXXIII: Ang Huling Matuwid</h2>
                <div class="chapter-content">
                    <p>Dumating ang araw ng pag-alis ni Simoun kasama ang Kapitan Heneral. Nakahanda na ang kanyang mga alahas at iba pang gamit. Naniniwala ang marami na hindi siya maaaring maiwan sa bansa sapagkat maaari siyang gantihan ng mga kaaway o usigin ng susunod na pinuno. Ayon sa iba, tulad siya ng isang hayop na lumilipat ng tirahan kapag may panganib.</p>
                    <p>Nagkulong si Simoun sa kanyang silid dahil sa isang mabigat na pasya. Ipinagbilin niyang si Basilio lamang ang papapasukin. Nang dumating ang binata, agad na napansin ang matinding pagbabago sa kanyang anyo siya'y payat, gusot ang buhok, magulo ang kasuotan, at wala na ang dating kabaitan sa kanyang mga mata. Sa halip, bakas dito ang galit at poot, na ikinagulat ni Simoun.</p>
                    <p>Magalang na bumati si Basilio at inamin na nagkulang siya bilang anak at kapatid. Ayon sa kanya, binalewala niya noon ang pagkapatay sa huli at ang kahirapang naranasan ng una kaya siya pinarusahan ng Diyos. Dahil dito, handa na raw siyang gumanti ng kasamaan sa kasamaan.</p>
                    <p>Tahimik lamang na nakinig si Simoun. Ipinahayag ni Basilio na ang pag-iwas niya noon sa kaguluhan at sa mga plano ni Simoun ang naging dahilan ng kanyang pagkabilanggo. Kaya ngayon, buo na ang loob niyang sumanib sa kanya.</p>
                    <p>Doon lamang nagsalita si Simoun at sinabi niyang ang pagdating ni Basilio ang nag-alis ng kanyang pag-aalinlangan. Ayon sa kanya, wala nang natitirang pag-ibig sa kanyang puso at tuluyan na niyang ipatutupad ang paghihimagsik. Ipinaliwanag niyang kung noon pa sila nagkaisa, maaaring naging makatao at hindi madugo ang kanilang layunin, ngunit dahil sa takot at pagkamakasarili ng mga tao, napilitan siyang dumaan sa marahas na paraan.</p>
                    <p>Hindi lubos na maunawaan ni Basilio ang mga sinabi ni Simoun. Dinala siya nito sa laboratoryo at ipinakita ang isang kakaibang ilawan na hugis granada. Nang buksan ito, nakita ni Basilio ang sisidlang bakal na puno ng nitrogliserina.</p>
                    <p>Ipinaliwanag ni Simoun na hindi ito ordinaryong dinamita kundi sandata ng mga inaapi laban sa karahasan at pang-aapi. Sinabi niyang ang ilawang ito ang magiging simula ng pagganti sa mga mapang-api at sa mga nagtatago sa likod ng relihiyon at pamahalaan.</p>
                    <p>Ikinuwento ni Simoun ang plano: gagamitin ang ilawan sa isang pista at makalipas ang ilang minuto ay sasabog ito, kasunod ang iba pang pampasabog sa loob ng kainan. Wala raw makaliligtas sa pagsabog.</p>
                    <p>Nang sabihin ni Basilio na tila hindi na siya kailangan, ipinaliwanag ni Simoun na mahalaga ang kanyang papel. Si Basilio ang mangunguna sa mga mamamayan sa labas ng lungsod, kukuha ng mga armas sa tindahan ni Quiroga, at magbabantay sa mga tulay. Si Kabesang Tales naman ang kikilos sa loob ng lungsod upang tuluyang sakupin ito.</p>
                    <p>Tahasan ding sinabi ni Simoun na walang dapat patawarin Indiyo, Mestiso, Intsik, o Kastila sapagkat para sa kanya, kailangang lipulin ang mahihina at takot upang makabuo ng bagong lipunang malakas. Para kay Simoun, ang kamatayan ay bahagi ng paglikha ng bagong kaayusan.</p>
                    <p>Bagama't nabigla, hindi na sinuri ni Basilio ang kabangisan ng plano. Nabura ang galit at paghihiganti ng kanyang pag-iisip. Nang itanong niya kung ano ang magiging tingin ng mundo sa ganitong karahasan, sinabi ni Simoun na laging pumapanig ang mundo sa mas makapangyarihan.</p>
                    <p>Tinanggap ni Basilio ang paliwanag at winika na wala na siyang pakialam sa sasabihin ng lipunan. Dahil dito, iniabot ni Simoun ang isang rebolver at tinakda ang oras at lugar ng kanilang pagkikita.</p>
                    <p>Tahimik na sinuri ni Basilio ang sandata, nagpaalam, at umalis handa na sa papel na kanyang gagampanan sa nalalapit na paghihimagsik.</p>
                </div>
                <!-- REMOVED audio player for Kabanata 33 -->
            </div>

            <!-- KABANATA 34 -->
            <div class="chapter-block" id="kabanata34">
                <h2>KABANATA XXXIV: Ang Kasal ni Paulita</h2>
                <div class="chapter-content">
                    <p>Si Basilio ay nasa daan ng ika-8 ng gabi. Nais niyang makituloy kina Isagani ngunit wala ito. Naisip ni Basilio ang mga dadanak na dugo makalipas ang 2 oras. Isinalat niya ang rebolver at mga bala. Naalala nya ang babala sa kanya ni Simoun na lumayo sa Anloague. Naghinala ang binata dahil nasa daang iyon ang bahay ni Kapitan Tiyago. Sa bahay na iyon ay idaraos ang piging sa kasal nina Juanito at Paulita. Nabagbag siya kay Isagani ng makita niya ang pagdating ng sasakyan ng bagong kasal. Ninais ni Basilio na yakaging isama si Isagani ngunit alam nyang hindi papayag ang binata dahil hindi pa ito nakakaranas ng nangyari sa kanya. Nagunita niya ang kanyang mga pasakit.</p>
                    <p>Nakita niyang Dumating si Simoun kasunod ng bagong kasal. Halos doon ang punta ng lahat. May dalawang tanod. Matataas na tao ang mga panahuin at pawang nagkakasiyahan. Si Simoun ang nagpautang ng salapi upang maiayos ng gayong kadingal ang bahay ni Kapitan Tiyago. Darating ang Kapitan Heneral bilang ninong dala ang ilawang handog ni Simoun.</p>
                    <p>Ang bahay ay dinikitan ng magagarang papel at magagarang arya at mga bulaklak ang palamuti. Mga angkat ang alpombra. Kurtinang pulang pelus na nabuburdahan ng ginto at unang titik ng pangalan ng mag-asawa. May itinuhog na artipisyal na bulaklak sa suha. Parang hapag ng mga diyoses ang pagdarausan ng hapunan. Ang mesa ay para sa mga dakilang panauhin at ang asotea ay para sa mga pitong nakaluklok diyos-diyosan. Naroon ang pinaka masarap at pinakamahal na alak. Kung nanaisin ni Kapitan Heneral ay pati laman ng tao ay ilalagay ni Don Timoteo.</p>
                </div>
                <!-- REMOVED audio player for Kabanata 34 -->
            </div>

            <!-- KABANATA 35 -->
            <div class="chapter-block" id="kabanata35">
                <h2>KABANATA XXXV: Ang Piging</h2>
                <div class="chapter-content">
                    <p>Ikapito ng gabi ng magsimulang dumating ang mga may paanyaya. Dumating ang bagong kasal kasama si Donya Victoria. Naroon na sila Padre Irene at Padre Salvi ngunit wala pa ang Heneral. Makalipas ang eksena tungkol sa Kromo sa pader ay dumating na ang heneral.</p>
                    <p>Si Basilio ay nasa harap ng bahay habang naaawa sa mga walang malay na mamamatay. Ninais niyang magbigay babala ngunit natigilan siya sa pagdating ng sasakyan ni Padre Irene at Padre Salvi. Inaalala nya ang kabutihang gawa sa kanya ni Simoun at ang kanyang sinapit sa pagiging matiisin.</p>
                    <p>Nakita nya ang pagdating ni Simoun na nag-alinlangan sa pagpanhik ngunit nagtuloy parin. Nakipag usap ng kaunti sa Heneral at ibang panauhin bago mawala sa paningin ng binata. Naghari ang kabutihang loob ni Basilio kung kaya't ninais na iligtas ang nangasabahay pinigilan ng mga tanong dahil sa marusing niyang anyo. Nang makita ito ni Simoun ay agad itong sumakay sa kanyang sasakyan paalis.</p>
                    <p>Nakita ni Basilio si Isagani na tatanaw-tanaw sa bahay. Sinubukan na iligtas ang kaibigan ngunit nang malaman ni Isagani ang masamang balak ay pumasok ito sa bahay habang si Basilio ay lumayo.</p>
                    <p>Ang isang nagpipiging nakatagpo ng isang kaputol na papel na may nakasulat na "MANE THACEL PHARES JUAN CRISOSTOMO IBARRA" Inakalang biro ni Don Custodio ngunit pinabulaanan ni Padre Salvi na iyon mismo ang lagda ni Ibarra. Nagkatinginan sa takot ang lahat. Napansin ng Heneral na walang mga kawal kung kaya ay nagpayo na magpatuloy sa pagkain upang itago ang takot. Nagsabi si Don Custudio na palagay niyang papatayin na silang lahat ng gabing iyon at may nagsabing baka lasunin sila.</p>
                    <p>Lumabo ang ilawan kung kaya inutusan ng Kapitan Heneral si Padre Irene na itaas ang huling mitsa. Biglang may mabilis na pumasok, kinuha ang ilawan, itinakbo sa asotea, itinapon sa ilog at nang pinagkamalan na magnanakaw ay tumalon ang anino sa ilog.</p>
                </div>

                <!-- Single audio player for all chapters -->
                <div class="combined-audio-player">
                    <h3>Pakinggan ang Diyalog ng Kabanata XXXIII-XXXV</h3>
                    <div class="audio-controls">
                        <audio controls id="combinedChapterAudio" preload="auto">
                            <source src="audio/K33-35.MP3" type="audio/mpeg">
                            Ang iyong browser ay hindi sumusuporta sa audio player.
                        </audio>
                      <p class="audio-note"><em>Ang audio ay magpe-play awtomatiko o maaaring ipagpatuloy mula sa huling posisyon.</em></p>
                    </div>
                </div>
            </div>

            <div class="chapter-navigation-container">
                <div class="chapter-navigation">
                    <button class="nav-btn next-btn" onclick="window.location.href='talasalitaan33-35.html'">
                        Magpatuloy sa Talasalitaan →
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script src="script-chapters.js"></script>
    <script src="rain.js"></script>
    <script>
    // Auto-play script for combined chapter audio with state persistence
    document.addEventListener('DOMContentLoaded', function() {
        const audioElement = document.getElementById('combinedChapterAudio');
        if (!audioElement) return;

        // Set up audio element ID for state tracking
        if (!audioElement.id) {
            audioElement.id = 'combinedAudio33-35';
        }

        // Load saved playback state
        loadAudioState(audioElement, '33-35');
        
        // Set up event listeners for state saving
        setupAudioEventListeners(audioElement, '33-35');
        
        // Try to auto-play with user interaction detection
        attemptAutoPlay(audioElement, '33-35');
        
        // Also try to play when page becomes visible again
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden && audioElement.paused && 
                sessionStorage.getItem('userInteractedWithAudio') === 'true') {
                attemptAutoPlay(audioElement, '33-35');
            }
        });
    });
    
    function loadAudioState(audioElement, chapterKey) {
        try {
            const savedTime = sessionStorage.getItem(`chapter${chapterKey}AudioPosition`);
            const savedIsPlaying = sessionStorage.getItem(`chapter${chapterKey}AudioIsPlaying`);
            const audioSource = sessionStorage.getItem(`chapter${chapterKey}AudioSource`);
            
            // Only restore if it's the same audio source
            const currentSource = audioElement.querySelector('source').src;
            if (savedTime && audioSource === currentSource) {
                const time = parseFloat(savedTime);
                const duration = audioElement.duration;
                
                // Only restore if position is valid and not too close to end
                if (!isNaN(time) && time > 0 && time < (duration || Infinity) - 1) {
                    audioElement.currentTime = time;
                }
                
                // Restore playback state
                if (savedIsPlaying === 'true' && audioElement.paused) {
                    sessionStorage.setItem(`shouldResumeAudio${chapterKey}`, 'true');
                }
            }
            
            // Save current source for future checks
            sessionStorage.setItem(`chapter${chapterKey}AudioSource`, currentSource);
        } catch (e) {
            console.error('Error loading audio state:', e);
        }
    }
    
    function setupAudioEventListeners(audioElement, chapterKey) {
        // Save playback position regularly
        audioElement.addEventListener('timeupdate', function() {
            if (!audioElement.paused && audioElement.currentTime > 0) {
                sessionStorage.setItem(`chapter${chapterKey}AudioPosition`, audioElement.currentTime);
            }
        });
        
        // Save play state
        audioElement.addEventListener('play', function() {
            sessionStorage.setItem(`chapter${chapterKey}AudioIsPlaying`, 'true');
            sessionStorage.setItem('userInteractedWithAudio', 'true');
        });
        
        audioElement.addEventListener('pause', function() {
            sessionStorage.setItem(`chapter${chapterKey}AudioIsPlaying`, 'false');
        });
        
        audioElement.addEventListener('ended', function() {
            sessionStorage.removeItem(`chapter${chapterKey}AudioPosition`);
            sessionStorage.removeItem(`chapter${chapterKey}AudioIsPlaying`);
            sessionStorage.removeItem(`shouldResumeAudio${chapterKey}`);
            // Update the note to show audio is finished
            const audioNote = document.querySelector('.audio-note');
            if (audioNote) {
                audioNote.innerHTML = '<em>Tapos na ang audio ng Kabanata XXXIII-XXXV.</em>';
            }
        });
        
        // Save state before page unload
        window.addEventListener('beforeunload', function() {
            if (!audioElement.paused && audioElement.currentTime > 0) {
                sessionStorage.setItem(`chapter${chapterKey}AudioPosition`, audioElement.currentTime);
                sessionStorage.setItem(`chapter${chapterKey}AudioIsPlaying`, 'true');
            }
        });
        
        // Handle user interaction with audio element
        audioElement.addEventListener('click', function() {
            sessionStorage.setItem('userInteractedWithAudio', 'true');
        });
        
        audioElement.addEventListener('play', function() {
            sessionStorage.setItem('userInteractedWithAudio', 'true');
        });
        
        // Handle audio errors
        audioElement.addEventListener('error', function() {
            const audioControls = audioElement.closest('.audio-controls');
            if (audioControls) {
                const errorNote = document.createElement('p');
                errorNote.className = 'audio-note'; 
                errorNote.style.color = '#cc0000';
                errorNote.innerHTML = `<em>Hindi ma-play ang audio file. Paki-check kung naka-save bilang "K33-35.mp3" sa audio folder.</em>`;
                audioControls.appendChild(errorNote);
            }
        });
    }
    
    function attemptAutoPlay(audioElement, chapterKey) {
        // Check if we should resume playback
        const shouldResume = sessionStorage.getItem(`shouldResumeAudio${chapterKey}`) === 'true';
        const userInteracted = sessionStorage.getItem('userInteractedWithAudio') === 'true';
        
        if (shouldResume || userInteracted) {
            // Small delay to ensure page is ready
            setTimeout(() => {
                const playPromise = audioElement.play();
                
                if (playPromise !== undefined) {
                    playPromise.catch(error => {
                        console.log('Auto-play prevented:', error);
                        
                        // Only show fallback if this is the first load
                        if (!userInteracted) {
                            showAutoplayFallback(audioElement, chapterKey);
                        }
                    }).then(() => {
                        // Clear the resume flag if successful
                        sessionStorage.removeItem(`shouldResumeAudio${chapterKey}`);
                        
                        // Update the note
                        const audioNote = document.querySelector('.audio-note');
                        if (audioNote) {
                            const currentTime = Math.floor(audioElement.currentTime);
                            audioNote.innerHTML = `<em>Nagpe-play ang audio mula ${formatTime(currentTime)}. I-refresh ang pahina upang ipagpatuloy mula dito.</em>`;
                        }
                    });
                }
            }, 300);
        } else {
            // First visit, show fallback button
            showAutoplayFallback(audioElement, chapterKey);
        }
    }
    
    function showAutoplayFallback(audioElement, chapterKey) {
        const audioContainer = audioElement.closest('.audio-controls');
        if (!audioContainer) return;
        
        // Remove any existing overlay
        const existingOverlay = audioContainer.querySelector('.autoplay-fallback');
        if (existingOverlay) existingOverlay.remove();
        
        const overlay = document.createElement('div');
        overlay.className = 'autoplay-fallback';
        overlay.style.marginTop = '15px';
        overlay.style.padding = '15px';
        overlay.style.backgroundColor = '#f8f3e9';
        overlay.style.borderRadius = '8px';
        overlay.style.border = '1px solid #e0d5c0';
        overlay.style.textAlign = 'center';
        
        // Check if there's saved position
        const savedTime = sessionStorage.getItem(`chapter${chapterKey}AudioPosition`);
        let timeInfo = '';
        if (savedTime) {
            const time = Math.floor(parseFloat(savedTime));
            timeInfo = `<p style="margin-bottom: 5px; color: #5c2e0f; font-size: 0.9em;">
                <strong>Naka-save na posisyon:</strong> ${formatTime(time)}
            </p>`;
        }
        
        overlay.innerHTML = `
            <p style="margin-bottom: 10px; color: #5c2e0f; font-size: 0.95em;">
                <strong>I-play ang Kabanata XXXIII-XXXV</strong>
            </p>
            ${timeInfo}
            <button class="play-overlay-btn" 
                    onclick="resumeChapterAudio3335(this)"
                    style="background: linear-gradient(to bottom, #5c2e0f, #4a240c); 
                           color: white; padding: 10px 20px; border: none; 
                           border-radius: 6px; cursor: pointer; font-weight: bold;
                           font-size: 1em; box-shadow: 0 3px 5px rgba(0,0,0,0.2);
                           margin-top: 10px;">
                ▶ Simulan ang Audio
            </button>
            <p style="margin-top: 8px; font-size: 0.8em; color: #777;">
                Magpe-play mula sa simula o huling posisyon.
            </p>
        `;
        
        audioContainer.appendChild(overlay);
    }
    
    // Helper function to format time
    function formatTime(seconds) {
        const mins = Math.floor(seconds / 60);
        const secs = Math.floor(seconds % 60);
        return `${mins}:${secs < 10 ? '0' : ''}${secs}`;
    }
    
    // Global function for resume button (Kabanata 33-35)
    window.resumeChapterAudio3335 = function(button) {
        const audioElement = document.getElementById('combinedChapterAudio');
        if (audioElement) {
            audioElement.play().then(() => {
                const overlay = button.closest('.autoplay-fallback');
                if (overlay) overlay.remove();
                sessionStorage.setItem('userInteractedWithAudio', 'true');
                
                // Update the note
                const audioNote = document.querySelector('.audio-note');
                if (audioNote) {
                    const currentTime = Math.floor(audioElement.currentTime);
                    audioNote.innerHTML = `<em>Nagpe-play ang audio ng Kabanata XXXIII-XXXV mula ${formatTime(currentTime)}.</em>`;
                }
            }).catch(error => {
                console.error('Playback failed:', error);
                alert('Hindi ma-play ang audio. Pakisubukan muli o i-check ang audio file.');
            });
        }
    };
</script>
</body>
</html>